<p style="color: green"><%= notice %></p>

<h1>Projects <%= link_to "", new_project_path, class: "btn btn-outline-dark bi bi-file-plus-fill" %> </h1>

<table class="table table-striped table-hover table table-bordered" style="background-color: #e3f2fd;">
  <thead class="table" style="background-color: #3AAFA9;">
    <tr>
      <th>Client</th>
      <th>Code</th>
      <th>Date</th>
      <th>Status</th>
      <th>Amount</th>
      <th>Change Status</th>
      <th colspan="3"></th>
    </tr>
  </thead>

<tbody>
  <% @projects.each do |project| %>
    <tr>
        <td><%= project.client.name %></td>
        <td><%= project.code %></td>
        <td><%= project.date%>
        <td><%= project.status.name %></td>
        <td><%= project.amount %></td>

        <td>
          <%= form_with(model: project) do |form| %>
             <% if project.status.code == 1 %>
            <%# IF THE PROJECT IS IN THE FIRST STATUS SELEC IF IT'S APPROVED OR REJECTED %>
                <%= form.select :status_id, [["Proposal approved", Status.find_by(code:2).id],["Rejected project", Status.find_by(code:9).id]], class:"btn btn-secondary dropdown toggle", id:"change_status"%>
            <% elsif project.status.code == 8 or project.status.code == 9 or project.status.code == 10 %>
            <%# IF THE PROJECT STATUS IS IN THE OPTIONS THAT CAN ONLY BE ENDED SHOW THAT OPTION %>
                <%= form.select :status_id, [["Finished project", Status.find_by(code: 10).id]], class:"btn btn-secondary dropdown toggle", id:"change_status"%>
            <% else %>
            <%# IF THE PROJECT STATUS IS IN ANY OTHER OPTION SHOW THE NEXT STATUS%>
              <%= form.select :status_id, [[Status.find_by(code: (project.status.code + 1)).name, Status.find_by(code: (project.status.code + 1)).id]], class:"btn btn-secondary dropdown toggle", id:"change_status"%>
            <%end%>
            <%=form.submit%>
          <%end%>
        </td>


        <td><%= link_to "", project, class: "btn btn-outline-dark bi bi-search" %>
        <td><%= link_to "", edit_project_path(project), class: "btn btn-outline-dark bi bi-pencil-square" %></td>
        <td><%= button_to "", project, method: :delete, data: {cofirm: 'Are you sure?'}, class: "btn btn-outline-dark bi bi-trash3-fill" %></td>
      </tr>
    <% end %>
  </tbody>
</table>


